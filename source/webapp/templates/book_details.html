{% extends 'base.html' %}

{% block title %}Книга{% endblock %}

{% block content %}
    <h1 class="mt-2">{{ book.title }}</h1>
    <p>Год издания: {{ book.year }} Автор: {{ book.author.name }}</p>
    <p>
        {% if user %}
            <a class="float-right" href="{% url 'webapp:book_update' book.pk %}">Редактировать</a>
            <a class="float-right" href="{% url 'webapp:book_delete' book.pk %}">Удалить</a>
        {% endif %}
    </p>
    <form method="POST" enctype="multipart/form-data" action="{% url 'webapp:add_book' book.pk %}" id="shelf">
        {% csrf_token %}
        <button type="submit">Добавить на полку</button>
    </form>
    {% if book.image %}
        <div class="img-wrapper">
            <img class="w-50" src="{{ book.image.url }}" alt="{{ book.image.name }}">
        </div>
    {% endif %}
    {% if book.file %}
        <div class="card-body">
            <div class="img-wrapper">
                <a href="{{ book.file.url }}" download>Скачать книгу</a>
            </div>
        </div>
    {% endif %}
    <p class="mt-3 pre-spaces">{{ book.description }}</p>

    {% include 'review_list.html' with review_list=reviews %}
    <form method="post" enctype="multipart/form-data" action="{% url 'webapp:review_create' book.id %}">
        {% csrf_token %}
        {% include 'partial/review_form.html' %}
    </form>
    <script language="JavaScript">
    $(document).ready(function() {
        $('#shelf button[type="submit"]').click(function(e) { // catch the form's submit event
            e.preventDefault();
            url = e.target.form.action;
            csrf = $("input[name='csrfmiddlewaretoken']", e.target.form).val();

            $.ajax({
                data: {"csrfmiddlewaretoken": csrf},
                type: e.target.form.method,
                url: url,
                success: function(response) { // on success..
                    alert("Вы добавили эту книгу!")
                },
                error: function(response) {
                    alert("Эта книга уже добавлена!")
                }
            });
            return false;
        });
    })
</script>
{% endblock %}
